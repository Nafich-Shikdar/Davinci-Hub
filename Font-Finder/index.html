<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Font Finder - Bangla Fonts</title>
    
    <!-- React & Tailwind -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1); width: 40px; height: 40px;
            border-radius: 50%; border-left-color: #4f46e5; animation: spin 1s ease infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Smooth scrolling */
        html { scroll-behavior: smooth; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- CONFIG ---
        const GITHUB_USERNAME = 'Nafich-Shikdar';
        const GITHUB_REPO = 'DaVinci'; 
        const GITHUB_BRANCH = 'main';
        const BASE_PATH = 'Font-Finder';

        // Icons
        const IconDownload = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const IconSearch = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const IconMoon = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>;
        const IconSun = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>;
        const IconSad = ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M16 16s-1.5-2-4-2-4 2-4 2"/><line x1="9" x2="9.01" y1="9" y2="9"/><line x1="15" x2="15.01" y1="9" y2="9"/></svg>;

        function App() {
            const [fonts, setFonts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [previewText, setPreviewText] = useState('আমার সোনার বাংলা, আমি তোমায় ভালোবাসি।');
            const [fontSize, setFontSize] = useState(32);
            const [searchQuery, setSearchQuery] = useState('');
            const [darkMode, setDarkMode] = useState(true);
            const [downloadingId, setDownloadingId] = useState(null);

            useEffect(() => {
                // UPDATE: Using full URL for fonts.json to avoid relative path errors in some environments
                const jsonUrl = `https://cdn.jsdelivr.net/gh/${GITHUB_USERNAME}/${GITHUB_REPO}@${GITHUB_BRANCH}/${BASE_PATH}/fonts.json`;

                fetch(jsonUrl)
                    .then(res => {
                        if (!res.ok) throw new Error("Could not load font list.");
                        return res.json();
                    })
                    .then(data => {
                        const processedFonts = data.map(font => ({
                            ...font,
                            url: `https://cdn.jsdelivr.net/gh/${GITHUB_USERNAME}/${GITHUB_REPO}@${GITHUB_BRANCH}/${BASE_PATH}/fonts/${encodeURIComponent(font.filename)}`
                        }));
                        setFonts(processedFonts);
                        setLoading(false);
                    })
                    .catch(err => {
                        console.error("Error fetching fonts.json:", err);
                        // Fallback logic could go here, but for now showing error
                        setError("Font list load kora jacche na. Check console for details.");
                        setLoading(false);
                    });
            }, []);

            // Dynamic CSS Injection
            useEffect(() => {
                const style = document.createElement('style');
                let css = '';
                fonts.forEach(font => {
                    const fontName = font.name.replace(/[^a-zA-Z0-9]/g, '');
                    css += `
                        @font-face {
                            font-family: '${fontName}';
                            src: url('${font.url}');
                            font-display: swap;
                        }
                    `;
                });
                style.appendChild(document.createTextNode(css));
                document.head.appendChild(style);
                return () => {
                    if (document.head.contains(style)) document.head.removeChild(style);
                };
            }, [fonts]);

            // Download Handler
            const handleDownload = async (font) => {
                setDownloadingId(font.id);
                try {
                    const response = await fetch(font.url);
                    if (!response.ok) throw new Error("Network response was not ok");
                    
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = font.filename;
                    
                    document.body.appendChild(a);
                    a.click();
                    
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } catch (err) {
                    console.error("Download failed, opening in new tab", err);
                    window.open(font.url, '_blank');
                } finally {
                    setDownloadingId(null);
                }
            };

            const filteredFonts = fonts.filter(font => 
                font.name.toLowerCase().includes(searchQuery.toLowerCase())
            );

            return (
                <div className={`min-h-screen transition-colors duration-300 flex flex-col ${darkMode ? 'bg-slate-900 text-slate-100' : 'bg-slate-50 text-slate-900'}`}>
                    
                    {/* Header */}
                    <header className={`sticky top-0 z-50 border-b backdrop-blur-md ${darkMode ? 'bg-slate-900/80 border-slate-700' : 'bg-white/80 border-slate-200'}`}>
                        <div className="container mx-auto px-4 py-4 flex justify-between items-center">
                            <h1 className="text-2xl font-bold bg-gradient-to-r from-indigo-500 to-purple-500 bg-clip-text text-transparent cursor-pointer" onClick={() => window.scrollTo(0,0)}>
                                Font Finder
                            </h1>
                            <button 
                                onClick={() => setDarkMode(!darkMode)} 
                                className={`p-2 rounded-full transition-colors ${darkMode ? 'hover:bg-slate-700 bg-slate-800' : 'hover:bg-gray-200 bg-white shadow-sm'}`}
                            >
                                {darkMode ? <IconSun className="w-5 h-5 text-yellow-400"/> : <IconMoon className="w-5 h-5 text-slate-600"/>}
                            </button>
                        </div>
                    </header>

                    {/* Controls */}
                    <div className={`sticky top-[73px] z-40 border-b shadow-sm ${darkMode ? 'bg-slate-800/95 border-slate-700' : 'bg-white/95 border-slate-200'}`}>
                        <div className="container mx-auto px-4 py-4 space-y-4">
                            <div className="flex flex-col md:flex-row gap-4">
                                <input 
                                    type="text" 
                                    value={previewText} 
                                    onChange={(e) => setPreviewText(e.target.value)} 
                                    className={`flex-1 p-3 rounded-xl border outline-none focus:ring-2 focus:ring-indigo-500 transition-all ${darkMode ? 'bg-slate-900 border-slate-600 focus:border-indigo-500' : 'bg-slate-50 border-slate-300'}`}
                                    placeholder="Type something to preview..."
                                />
                                <div className="relative md:w-1/3">
                                    <IconSearch className="absolute left-3 top-3.5 text-gray-400 w-4 h-4"/>
                                    <input 
                                        type="text" 
                                        value={searchQuery} 
                                        onChange={(e) => setSearchQuery(e.target.value)} 
                                        className={`w-full pl-9 p-3 rounded-xl border outline-none focus:ring-2 focus:ring-indigo-500 transition-all ${darkMode ? 'bg-slate-900 border-slate-600 focus:border-indigo-500' : 'bg-slate-50 border-slate-300'}`}
                                        placeholder="Search fonts..."
                                    />
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="text-xs font-medium uppercase tracking-wider opacity-60">Size</span>
                                <input 
                                    type="range" 
                                    min="12" max="120" 
                                    value={fontSize} 
                                    onChange={(e) => setFontSize(Number(e.target.value))} 
                                    className="w-full h-2 rounded-lg appearance-none cursor-pointer bg-indigo-200 accent-indigo-600"
                                />
                                <span className="text-xs font-mono w-8">{fontSize}px</span>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <main className="container mx-auto px-4 py-8 flex-grow">
                        {loading && (
                            <div className="flex flex-col items-center justify-center py-20 animate-pulse">
                                <div className="spinner mb-4 border-indigo-500"></div>
                                <p className="opacity-60">Loading fonts...</p>
                            </div>
                        )}

                        {error && (
                            <div className="text-center py-12 text-red-500 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-800">
                                <p className="font-bold">{error}</p>
                            </div>
                        )}

                        {!loading && !error && filteredFonts.length === 0 && (
                            <div className="flex flex-col items-center justify-center py-20 opacity-50">
                                <IconSad className="w-16 h-16 mb-4 text-slate-400"/>
                                <p className="text-xl font-medium">No fonts found matching "{searchQuery}"</p>
                            </div>
                        )}

                        {!loading && !error && filteredFonts.length > 0 && (
                            <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                                {filteredFonts.map((font) => (
                                    <div key={font.id || font.name} className={`group flex flex-col rounded-2xl border transition-all duration-300 hover:shadow-lg ${darkMode ? 'bg-slate-800 border-slate-700 hover:border-indigo-500/50' : 'bg-white border-slate-200 hover:border-indigo-300'}`}>
                                        
                                        {/* Card Header */}
                                        <div className="p-4 border-b border-dashed border-gray-200 dark:border-slate-700 flex justify-between items-start">
                                            <div>
                                                <h3 className="font-bold text-lg leading-tight group-hover:text-indigo-500 transition-colors">{font.name}</h3>
                                                <p className="text-xs opacity-50 mt-1">by {font.author}</p>
                                            </div>
                                            <span className={`text-[10px] px-2 py-1 rounded-full font-bold uppercase tracking-wider ${darkMode ? 'bg-indigo-900/50 text-indigo-300' : 'bg-indigo-50 text-indigo-600'}`}>
                                                {font.category || 'Font'}
                                            </span>
                                        </div>

                                        {/* Preview Area */}
                                        <div className={`flex-grow h-48 flex items-center justify-center p-6 overflow-hidden relative ${darkMode ? 'bg-slate-900/30' : 'bg-slate-50'}`}>
                                            <p 
                                                style={{
                                                    fontFamily: `'${font.name.replace(/[^a-zA-Z0-9]/g, '')}', sans-serif`, 
                                                    fontSize: `${fontSize}px`
                                                }} 
                                                className="text-center w-full break-words leading-tight"
                                            >
                                                {previewText}
                                            </p>
                                        </div>

                                        {/* Footer / Actions */}
                                        <div className="p-4 bg-gray-50 dark:bg-slate-800/50 flex justify-between items-center rounded-b-2xl">
                                            <span className="text-xs opacity-40 font-mono">.{font.filename.split('.').pop()}</span>
                                            
                                            <button 
                                                onClick={() => handleDownload(font)}
                                                disabled={downloadingId === font.id}
                                                className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all transform active:scale-95 ${
                                                    downloadingId === font.id 
                                                        ? 'bg-gray-400 cursor-not-allowed opacity-70' 
                                                        : 'bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-500/20'
                                                }`}
                                            >
                                                {downloadingId === font.id ? (
                                                    <>Processing...</>
                                                ) : (
                                                    <>
                                                        <IconDownload className="w-4 h-4"/> Download
                                                    </>
                                                )}
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {/* Simple Footer */}
                    <footer className={`py-6 text-center text-xs border-t ${darkMode ? 'border-slate-800 text-slate-600' : 'border-slate-200 text-slate-400'}`}>
                        <p>© {new Date().getFullYear()} Font Finder • Powered by GitHub & jsDelivr</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>